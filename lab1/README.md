# LW1

## Задание
  1. Реализовать программу согласно варианту задания. Базовый алгоритм, 
используемый в программе, необходимо реализовать в 3 вариантах: с 
использованием встроенных функций какой-либо библиотеки (OpenCV, 
PIL и др.) и нативно на Python + |с использованием Numba или C++|.
  2. Сравнить быстродействие реализованных вариантов.
  3. Сделать отчёт в виде readme на GitHub, там же должен быть выложен 
исходный код


## Вариант 2

   "Эквализация гистограммы". На вход поступает видео, программа на 
выходе отрисовывает два окна: с рассчитанной гистограммой и 
изображением. По нажатию определенной кнопки на клавиатуре 
изображение должно переключаться между исходным и после 
эквализации.

В рамках задания были реализованы 3 версии программы:
- с использованием opencv (equalizeHist);
- алгоритм эквализации пишется нативно на питоне (numpy, потому что CuPy от Rapids не завелся);
- алгоритм эквализации пишется нативно на питоне + используется Numba;

## Теоретическая база
Эквализация гистограммы - метод увеличения контрастности изображения. При обработке вычисляется гистограмма яркости 
пикслей изображения, считается функция распределения и применяется следующая формула
![img_3.png](screenshots/formula.svg)

Далее попиксельно применяются новые значения яркости.
## Описание разработанной системы
В целях упрощения системы, поддерживаются только Grayscale изображения. Расширение метода в RGB пространство подразумевает 
те же самые действия по трем каналам (и три графика на одном наборе координат). Кадры и гистограммы выводятся с помощью openCV во всех трех имплементациях с целью
репрезентативности измерений производительности.

Переключение режима работы производится нажатием клавиши "h".

## Замер производительности.
### Результат работы программы + вывод на экран до эквализации:

![screenshot](screenshots/casablanca.png)
Гистограмма все равно считается
### Результаты работы на OPENCV:

![img.png](screenshots/opencv.png)


### Алгоритм написанный нативно на питоне:

![img_2.png](screenshots/native.png)


### Алгоритм c использованием JIT

![img_3.png](screenshots/numba.png)

| Инструмент    | OpenCV | Numpy | Numba  |
|---------------|--------|-------|--------|
| Время на кадр | 0.0022 | 0.022 | 0.0048 |

OpenCV реализация предлагает лучшую производительность, скомпилированный вариант на Numba уступает ему в 2 раза, потому что не 
поддерживает masked_equal операции и они производятся медленнее, а чистый numpy - предсказуемо самый медленный из трех вариантов
## Сорсы
- https://habr.com/ru/post/244507/
- https://docs.opencv.org/4.x/ - доки
- https://www.math.uci.edu/icamp/courses/math77c/demos/hist_eq.pdf